<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Manuten√ß√£o de Ar-Condicionado</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial; background:#f2f2f2; padding:20px; }
.box { background:#fff; padding:20px; max-width:600px; margin:auto; border-radius:8px; }
input, textarea, button { width:100%; padding:10px; margin-top:10px; }
button { background:#007bff; color:#fff; border:none; cursor:pointer; }
button:hover { background:#0056b3; }
.hidden { display:none; }
.item { background:#eee; padding:10px; margin-top:10px; border-left:4px solid #007bff; }
</style>
</head>

<body>

<div class="box">
<h2>Manuten√ß√£o de Equipamento</h2>
<p><b>Equipamento:</b> <span id="equipamento"></span></p>

<!-- LOGIN T√âCNICO -->
<div id="loginBox">
  <h3>Login T√©cnico</h3>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="senha" placeholder="Senha">
  <button onclick="login()">Entrar</button>
</div>

<!-- √ÅREA T√âCNICO -->
<div id="areaTecnico" class="hidden">
  <h3>Registrar Manuten√ß√£o</h3>
  <input type="date" id="data">
  <input type="text" id="tecnico" placeholder="Nome do t√©cnico">
  <textarea id="servico" placeholder="Servi√ßo realizado"></textarea>
  <textarea id="obs" placeholder="Observa√ß√µes"></textarea>
  <button onclick="salvar()">Salvar Manuten√ß√£o</button>
  <button onclick="logout()">Sair</button>
</div>

<hr>

<!-- √ÅREA CLIENTE -->
<h3>Hist√≥rico de Manuten√ß√£o</h3>
<div id="lista"></div>

</div>

<script>
// üîß CONFIG FIREBASE (TROQUE!)
const firebaseConfig = {
  apiKey: "AIzaSyDD2Ydr3Z5gahJ11SfRlFMYn9OCVJ4XJQE",
  authDomain: "manutencaodear-5a2fb.firebaseapp.com",
  projectId: "manutencaodear-5a2fb"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// üì¶ EQUIPAMENTO VIA QR CODE
const params = new URLSearchParams(window.location.search);
const eq = params.get("eq") || "SEM_CODIGO";
document.getElementById("equipamento").innerText = eq;

// üîê LOGIN
function login(){
  auth.signInWithEmailAndPassword(
    email.value, senha.value
  ).catch(err => alert(err.message));
}

function logout(){
  auth.signOut();
}

// üîÑ CONTROLE DE LOGIN
auth.onAuthStateChanged(user => {
  if(user){
    loginBox.style.display = "none";
    areaTecnico.classList.remove("hidden");
  } else {
    loginBox.style.display = "block";
    areaTecnico.classList.add("hidden");
  }
});

// üíæ SALVAR MANUTEN√á√ÉO
function salvar(){
  if(!data.value || !tecnico.value || !servico.value){
    alert("Preencha os campos obrigat√≥rios");
    return;
  }

  db.collection("equipamentos")
    .doc(eq)
    .collection("historico")
    .add({
      data: data.value,
      tecnico: tecnico.value,
      servico: servico.value,
      obs: obs.value,
      criadoEm: new Date()
    })
    .then(() => {
      alert("‚úÖ Manuten√ß√£o salva");
      servico.value = "";
      obs.value = "";
      carregar();
    });
}

// üìú CARREGAR HIST√ìRICO
function carregar(){
  lista.innerHTML = "";
  db.collection("equipamentos")
    .doc(eq)
    .collection("historico")
    .orderBy("criadoEm","desc")
    .get()
    .then(res => {
      res.forEach(doc => {
        const d = doc.data();
        lista.innerHTML += `
          <div class="item">
            <b>${d.data}</b><br>
            T√©cnico: ${d.tecnico}<br>
            Servi√ßo: ${d.servico}<br>
            Obs: ${d.obs || "-"}
          </div>
        `;
      });
    });
}

carregar();
</script>

</body>
</html>
