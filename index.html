<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Manuten√ß√£o de Equipamentos</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    padding: 20px;
}
.container {
    max-width: 600px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
}
input, textarea, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
}
button {
    background: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
}
button:hover {
    background: #0056b3;
}
.historico {
    margin-top: 20px;
    padding: 10px;
    background: #eee;
    border-radius: 5px;
}
.item {
    background: #fff;
    padding: 8px;
    margin-bottom: 8px;
    border-left: 4px solid #007bff;
}
</style>
</head>

<body>

<div class="container">
    <h2>Manuten√ß√£o do Equipamento</h2>

    <p><b>Equipamento:</b> <span id="equipamento"></span></p>

    <input type="date" id="data">
    <input type="text" id="tecnico" placeholder="Nome do t√©cnico">
    <textarea id="servico" placeholder="Servi√ßo realizado"></textarea>
    <textarea id="observacoes" placeholder="Observa√ß√µes"></textarea>

    <button onclick="salvarManutencao()">Salvar Manuten√ß√£o</button>

    <div class="historico">
        <h3>Hist√≥rico</h3>
        <div id="lista"></div>
    </div>
</div>

<script>
// üîπ CONFIG FIREBASE (TROQUE PELO SEU)
const firebaseConfig = {
  apiKey: "AIzaSyDD2Ydr3Z5gahJ11SfRlFMYn9OCVJ4XJQE",
  authDomain: "manutencaodear-5a2fb.firebaseapp.com",
  projectId: "manutencaodear-5a2fb"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// üîπ PEGA EQUIPAMENTO DA URL
const params = new URLSearchParams(window.location.search);
const eq = params.get("eq") || "SEM_CODIGO";
document.getElementById("equipamento").innerText = eq;

// üîπ SALVAR MANUTEN√á√ÉO
function salvarManutencao() {
    const data = document.getElementById("data").value;
    const tecnico = document.getElementById("tecnico").value;
    const servico = document.getElementById("servico").value;
    const observacoes = document.getElementById("observacoes").value;

    if (!data || !tecnico || !servico) {
        alert("Preencha data, t√©cnico e servi√ßo");
        return;
    }

    db.collection("equipamentos")
      .doc(eq)
      .collection("historico")
      .add({
          data,
          tecnico,
          servico,
          observacoes,
          criadoEm: new Date()
      })
      .then(() => {
          alert("‚úÖ Manuten√ß√£o salva!");
          carregarHistorico();
          document.getElementById("servico").value = "";
          document.getElementById("observacoes").value = "";
      })
      .catch((erro) => {
          alert("Erro ao salvar");
          console.error(erro);
      });
}

// üîπ CARREGAR HIST√ìRICO
function carregarHistorico() {
    const lista = document.getElementById("lista");
    lista.innerHTML = "";

    db.collection("equipamentos")
      .doc(eq)
      .collection("historico")
      .orderBy("criadoEm", "desc")
      .get()
      .then((query) => {
          query.forEach((doc) => {
              const d = doc.data();
              lista.innerHTML += `
                <div class="item">
                    <b>${d.data}</b><br>
                    T√©cnico: ${d.tecnico}<br>
                    Servi√ßo: ${d.servico}<br>
                    Obs: ${d.observacoes || "-"}
                </div>
              `;
          });
      });
}

// üîπ CARREGA AO ABRIR
carregarHistorico();
</script>

</body>
</html>
