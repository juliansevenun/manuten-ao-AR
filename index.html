<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Manuten√ß√£o de Ar-Condicionado</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
.box{background:#fff;max-width:600px;margin:auto;padding:20px;border-radius:8px}
input,textarea,button{width:100%;padding:10px;margin-top:10px}
button{background:#007bff;color:#fff;border:none;cursor:pointer}
button:hover{background:#0056b3}
.hidden{display:none}
.item{background:#eee;padding:10px;margin-top:10px;border-left:4px solid #007bff}
hr{margin:20px 0}
</style>
</head>

<body>
<div class="box">

<h2>Manuten√ß√£o de Ar-Condicionado</h2>
<p><b>Equipamento:</b> <span id="equipamento"></span></p>

<!-- üîë LOGIN T√âCNICO (S√ì SENHA) -->
<div id="loginTecnico">
<h3>Acesso T√©cnico</h3>
<input type="password" id="senhaTecnico" placeholder="Senha do t√©cnico">
<button onclick="entrarTecnico()">Entrar</button>
</div>

<!-- üîß √ÅREA DO T√âCNICO -->
<div id="areaTecnico" class="hidden">
<h3>Registrar Manuten√ß√£o</h3>
<input type="date" id="data">
<input type="text" id="tecnico" placeholder="Nome do t√©cnico">
<textarea id="servico" placeholder="Servi√ßo realizado"></textarea>
<textarea id="obs" placeholder="Observa√ß√µes"></textarea>
<button onclick="salvar()">Salvar Manuten√ß√£o</button>
<button onclick="sairTecnico()">Sair</button>
</div>

<hr>

<!-- üëÅÔ∏è √ÅREA DO CLIENTE -->
<h3>Hist√≥rico de Manuten√ß√£o</h3>
<div id="lista"></div>

</div>

<script>
// üî• CONFIG FIREBASE (TROQUE!)
const firebaseConfig = {
  apiKey: "AIzaSyDD2Ydr3Z5gahJ11SfRlFMYn9OCVJ4XJQE",
  authDomain: "manutencaodear-5a2fb.firebaseapp.com",
  projectId: "manutencaodear-5a2fb"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// üîê SENHA DO T√âCNICO (VOC√ä DEFINE)
const SENHA_TECNICO = "211710"; // troque aqui

// üì¶ EQUIPAMENTO VIA QR CODE
const params = new URLSearchParams(window.location.search);
const eq = params.get("eq") || "SEM_CODIGO";
document.getElementById("equipamento").innerText = eq;

// üîë ENTRAR COMO T√âCNICO
function entrarTecnico(){
  if(senhaTecnico.value === SENHA_TECNICO){
    loginTecnico.style.display="none";
    areaTecnico.classList.remove("hidden");
    senhaTecnico.value="";
  }else{
    alert("Senha incorreta");
  }
}

// üö™ SAIR
function sairTecnico(){
  loginTecnico.style.display="block";
  areaTecnico.classList.add("hidden");
}

// üíæ SALVAR MANUTEN√á√ÉO
function salvar(){
  if(!data.value||!tecnico.value||!servico.value){
    alert("Preencha os campos obrigat√≥rios");
    return;
  }

  db.collection("equipamentos")
    .doc(eq)
    .collection("historico")
    .add({
      data:data.value,
      tecnico:tecnico.value,
      servico:servico.value,
      obs:obs.value,
      criadoEm:new Date()
    })
    .then(()=>{
      alert("‚úÖ Manuten√ß√£o salva");
      servico.value="";
      obs.value="";
      carregar();
    })
    .catch(e=>alert("Erro ao salvar"));
}

// üìú CARREGAR HIST√ìRICO
function carregar(){
  lista.innerHTML="";
  db.collection("equipamentos")
    .doc(eq)
    .collection("historico")
    .orderBy("criadoEm","desc")
    .get()
    .then(q=>{
      q.forEach(doc=>{
        const d=doc.data();
        lista.innerHTML+=`
        <div class="item">
          <b>${d.data}</b><br>
          T√©cnico: ${d.tecnico}<br>
          Servi√ßo: ${d.servico}<br>
          Obs: ${d.obs||"-"}
        </div>`;
      });
    });
}

carregar();
</script>

</body>
</html>
